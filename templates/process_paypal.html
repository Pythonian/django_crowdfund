{% extends 'base.html' %}
{% load static %}

{% block title %}Choose Payment Method{% endblock %}

{% block content %}
<div class="crowdfund-body-background">
  <div class="crowdfund-carousel owl-carousel crowdfund-carousel-bg" id="crowdfund-carousel-bg">
      <div class="crowdfund-slide" style="background-image: url({% static 'img/1.png' %});"></div>
  </div>
  <div class="crowdfund-background-overlay"></div>
</div>

<section class="crowdfund-section crowdfund-section-transparent">
    <div class="crowdfund-section-content">
        <div class="crowdfund-limit-width">
            <div class="crowdfund-content-padding">
                <div class="crowdfund-title">
                    <h2>Choose Payment Method</h2>
                    <div class="crowdfund-underline"></div>
                </div>
                <div class="crowdfund-content">
                    <div class="crowdfund-row">
                        <div class="crowdfund-col crowdfund-col-12">
                            <div class="crowdfund-row">
                                <div class="crowdfund-tab">
						            <div class="crowdfund-tab-header">
						            	<a class="crowdfund-tab-link" href="#">Pay with Paypal</a>
						            	<a class="crowdfund-tab-link" href="#">Pay with Paystack</a>
						            </div>
						            <div class="crowdfund-tab-container">
						                <div class="crowdfund-tab-content">
						                	<p>You'll be redirected to the Paypal platform to complete your payment.</p>
										    {{ paypal_form.render }}
						                </div>
						                <div class="crowdfund-tab-content">
						                	<form>
                                              <script src="https://js.paystack.co/v1/inline.js"></script>
                                              <button type="button" onclick="payWithPaystack()"> Pay With Paystack </button> 
                                            </form>
						                </div>
						            </div>
						        </div>
						        <div class="crowdfund-content-footer crowdfund-text-center">
				                    <a class="crowdfund-button crowdfund-button-big crowdfund-mobile-fullwidth" href="{% url 'home' %}">
				                        Abort Payment!
				                    </a>
				                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block paystack %}
<script>
  function payWithPaystack(){
    var handler = PaystackPop.setup({
      key: 'pk_test_c0132778c63a1edaea68bcb63104d512c45772a6',
      email: '{{ order.email }}',
      amount: {{ order.reward.amount }} * 360 * 100,
      currency: 'NGN',
      reference: ''+Math.floor((Math.random() * 1000000000) + 1),
      // metadata: {
      //    custom_fields: [
      //       {
      //           display_name: "Mobile Number",
      //           variable_name: "mobile_number",
      //           value: "+2348012345678"
      //       }
      //    ]
      // },
      callback: function(response){
          alert('Payment complete! Reference: ' + response.reference);
      },
      onClose: function(){
          alert('Transaction was not completed, window closed.');
      }
    });
    handler.openIframe();
  }
</script>
{% endblock %}